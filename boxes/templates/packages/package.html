{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center">
  <h2>{{ package.tracking_code }} - {{ package.carrier__name }}</h2>
</div>

{% include "_messages.html" %}

<hr />

{% if state_ledger %}
<h3>State Audit Log</h3>
<div class="table-responsive">
  <table class="table">
    <thead>
      <tr>
        <th scope="col">User</th>
        <th scope="col">State</th>
        <th scope="col">Timestamp</th>
      </tr>
    </thead>
    <tbody>
      {% for ledger in state_ledger %}
      <tr>
        <td>{{ ledger.user__first_name }} {{ ledger.user__last_name }}</td>
        <td>{{ ledger.state }}</td>
        <td class="timestamp" data-timestamp="{{ ledger.timestamp.isoformat }}">
            {{ ledger.timestamp }}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
$(document).ready(function() {
    $(".timestamp").each(function() {
        var iso_timestamp = $(this).data("timestamp");
        var local_time = new Date(iso_timestamp).toLocaleString();
        $(this).text(local_time);
    });
});
</script>
{% endif %}

{% endblock %}
